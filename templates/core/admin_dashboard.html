{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock title %}

{% block links %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock links %}

{% block content %}
{% include 'partials/_header.html' %}

<div class="container py-5">
    <!-- Welcome Section -->
    <div class="row mb-5">
        <div class="col-12">
            <h1 class="display-5 fw-bold text-primary">Admin Dashboard</h1>
            <p class="text-muted lead">Overview of system status and quick management actions.</p>
        </div>
    </div>

    <!-- Quick Actions Grid -->
    <div class="row g-4 mb-5">
        <div class="col-6 col-md-3">
            <a href="{% url 'manage_user' %}" class="text-decoration-none">
                <div class="card custom-card h-100">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i class="fa-solid fa-users card-icon display-4 mb-3"></i>
                        <h5 class="card-title">Manage Users</h5>
                        <p class="small opacity-75 mb-0">Add, edit, or remove users</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="{% url 'manage_mentee_assignments' %}" class="text-decoration-none">
                <div class="card custom-card h-100">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i class="fa-solid fa-user-group card-icon display-4 mb-3"></i>
                        <h5 class="card-title">Mentee Assignments</h5>
                        <p class="small opacity-75 mb-0">Assign mentees to mentors</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="{% url 'manage_assignment' %}" class="text-decoration-none">
                <div class="card custom-card h-100">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i class="fa-solid fa-link card-icon display-4 mb-3"></i>
                        <h5 class="card-title">General Assignments</h5>
                        <p class="small opacity-75 mb-0">Manage other assignments</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="{% url 'admin_config_home' %}" class="text-decoration-none">
                <div class="card custom-card h-100">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i class="fa-solid fa-sliders card-icon display-4 mb-3"></i>
                        <h5 class="card-title">Configuration</h5>
                        <p class="small opacity-75 mb-0">System dropdowns & settings</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="{% url 'mentor_mentee_list' %}" class="text-decoration-none">
                <div class="card custom-card h-100">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <i class="fa-solid fa-users-line card-icon display-4 mb-3"></i>
                        <h5 class="card-title">View Mentees</h5>
                        <p class="small opacity-75 mb-0">Access mentee profiles</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Analytics Section -->
    <div class="row g-4">
        <div class="col-lg-4 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <h5 class="fw-bold mb-0">User Distribution</h5>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center p-4">
                    <canvas id="overviewChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <h5 class="fw-bold mb-0">Endorser Status</h5>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center p-4">
                    <canvas id="endorserChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-12">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <h5 class="fw-bold mb-0">Mentors vs Endorsers</h5>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center p-4">
                    <canvas id="mentorEndorserChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Chart Defaults
        Chart.defaults.font.family = "'Outfit', sans-serif";
        Chart.defaults.color = '#64748b';

        // Colors
        const colors = {
            primary: '#2f3b81',  // Your brand blue
            secondary: '#575e71',
            success: '#10b981',
            warning: '#f59e0b',
            info: '#3b82f6',
            danger: '#ef4444',
            light: '#e2e8f0'
        };

        // 1. Endorsers Assignment (Doughnut)
        new Chart(document.getElementById('endorserChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Assigned', 'Unassigned'],
                datasets: [{
                    data: [{{ assigned_endorsers }}, {{ unassigned_endorsers }}],
            backgroundColor: [colors.success, colors.light],
            borderWidth: 0,
            hoverOffset: 4
        }]
            },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } }
        },
        cutout: '70%'
    }
        });

    // 2. Mentors vs Endorsers (Pie)
    new Chart(document.getElementById('mentorEndorserChart').getContext('2d'), {
        type: 'pie',
        data: {
            labels: ['Mentors', 'Endorsers'],
            datasets: [{
                data: [{{ total_mentors }}, {{ total_endorsers }}],
        backgroundColor: [colors.primary, colors.warning],
        borderWidth: 0
    }]
            },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } }
        }
    }
        });

    // 3. User Overview (Bar - repurposed from Doughnut for variety, or keep Doughnut)
    // Let's keep Doughnut for consistency but stylized
    new Chart(document.getElementById('overviewChart').getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: ['Mentors', 'Endorsers'],
            datasets: [{
                data: [{{ total_mentors }}, {{ total_endorsers }}],
        backgroundColor: [colors.info, colors.secondary],
        borderWidth: 0,
        hoverOffset: 4
    }]
            },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '60%',
        plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } }
        }
    }
        });
    });
</script>
{% endblock %}